(()=>{"use strict";var e={892:(e,t,s)=>{const i=s(921);class n{_pos;_samples;_connectedNodes;_hasPlayedYet;constructor(e){this._config={src:e,volume:1,pitch:1,pan:0,loop:!1},this.context=new AudioContext,this.gain=null,this.panner=null,this.source=null,this.steroPanner=null,this.nodes=[],this.buffer=null,this._samples=[],this._connectedNodes=[],this.onended||(this.onended=null),this.onload||(this.onload=null),this._hasPlayedYet=!1,this.saveOffset=0,this._pos=new i.SoundPosition,this.createNodes(),this.makeSourceNode()}get samples(){if(!this.buffer||!this.source)throw new Error("The Sound hasn't finished loading yet!");if(0==this._samples.length){var e=this.buffer.numberOfChannels,t=[];for(let s=0;s<e;s++)t.push(Array.prototype.slice.call(this.buffer.getChannelData(s)));return this._samples=t,t}return this._samples}get src(){return this._config.src}set src(e){this._config.src=e,this.stop(),this.makeSourceNode()}get pos(){return this._pos}set pos(e){this._pos=e,this.configureNodes()}get volume(){return 100*this._config.volume}set volume(e){this._config.volume=e/100,this.configureNodes()}get currentTime(){return this.context.currentTime}get pitch(){return this._config.pitch}get duration(){return this.buffer?this.buffer.duration:0}get numOfChannels(){return this.buffer?this.buffer.numberOfChannels:0}get sampleRate(){return this.buffer?this.buffer.sampleRate:0}set pitch(e){this._config.pitch=e,this.configureNodes()}get pan(){return 100*this._config.pan}set pan(e){this._config.pan=Math.max(Math.min(e,100),-100)/100,this.configureNodes()}get loop(){return this._config.loop}set loop(e){this._config.loop=e,this.configureNodes()}configureNodes(){this.gain.gain.setValueAtTime(this._config.volume,this.currentTime),this._pos.updateSoundPosition(this),this.steroPanner.pan.setValueAtTime(this._config.pan,this.currentTime),this.source&&(this.source.detune.setValueAtTime(this._config.pitch,this.currentTime),this.source.loop=this._config.loop)}createNodes(){var e,t,s,i=this.context;e=i.createGain(),t=i.createPanner(),s=i.createStereoPanner(),e.connect(i.destination),s.connect(e),t.connect(s),this.gain=e,this.steroPanner=s,this.panner=t,this.configureNodes()}unlinkNodes(){var e=[this.context.destination,this.gain,this.steroPanner,this.panner];(e=(e=e.concat(this._connectedNodes)).concat(this.source)).reverse(),e=e.filter((e=>-1!=this._connectedNodes.indexOf(e)));for(let t=0;t<e.length;t++){const t=e.shift();if(!t)break;t.disconnect(),this._connectedNodes.splice(this._connectedNodes.indexOf(t),1)}}linkNodes(){this.unlinkNodes();var e=[this.context.destination,this.gain,this.steroPanner,this.panner];(e=e.concat(this.nodes)).push(this.source),e.reverse();for(let t=0;t<e.length;t++){const t=e.shift();if(t&&this._connectedNodes.push(t),!(t&&e[0]instanceof AudioNode))break;t.connect(e[0])}this._connectedNodes=this._connectedNodes.filter((e=>e!=this.context.destination))}pushNode(e){this.nodes.unshift(e),this.unlinkNodes(),this.linkNodes()}popNode(e){if(e){var t=this.nodes.indexOf(e);return-1==t?null:(this.nodes.splice(t,1),this.unlinkNodes(),this.linkNodes(),e)}var s=this.nodes.pop()||null;return this.unlinkNodes(),this.linkNodes(),s}async getSoundBuffer(){return new Promise(((e,t)=>{this.buffer instanceof AudioBuffer&&e(this.buffer);var s=this._config.src,i=this.context;if(s instanceof ArrayBuffer)i.decodeAudioData(s,(t=>{e(t)}),(e=>{t(e)}));else if("string"!=typeof s||this.buffer)s instanceof AudioBuffer?e(s):t("Invalid Source Type.");else{var n=window.location.origin+"/"+s;/http(s?):\/\//g.test(s)&&(n=s);var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){i.decodeAudioData(o.response,(t=>{e(t)}),(e=>{t(e)}))},o.onerror=e=>{t(e.toString())},o.send(null)}}))}async makeSourceNode(){var e,t=await this.getSoundBuffer(),s=this.context;this.source&&(this.unlinkNodes(),this.source=null),(e=s.createBufferSource()).buffer=t,this.buffer=t,this._hasPlayedYet=!1,this.source=e,this.linkNodes(),this.onload instanceof Function&&this.onload.call(null,t,e)}play(e,t,s){if(!this.buffer||!this.source)throw new Error("The Sound hasn't finished loading yet!");if(this._hasPlayedYet)return this.makeSourceNode(),void(this.onload=()=>{this.play.apply(this,arguments)});0!=this.saveOffset&&(e=this.saveOffset,this.saveOffset=0),this.source&&!this._hasPlayedYet&&(this.context.resume(),this._hasPlayedYet=!0,this.source.start(e,t,s),this.source.onended=e=>{this.source.stop(),this.makeSourceNode(),this.onended instanceof Function&&this.onended(e)})}pause(){if(!this.buffer||!this.source)throw new Error("The Sound hasn't finished loading yet!");this.saveOffset=this.context.currentTime,this.context.suspend();try{this.source.stop()}catch(e){}this.makeSourceNode(),this.onended instanceof Function&&this.onended(null)}stop(){if(!this.buffer||!this.source)throw new Error("The Sound hasn't finished loading yet!");this.saveOffset=0,this.context.suspend();try{this.source.stop()}catch(e){}this.makeSourceNode(),this.onended instanceof Function&&this.onended(null)}copy(){var e=new n(this.src);return e.pitch=this.pitch,e.volume=this.volume,e.nodes=this.nodes,e.loop=this.loop,e.pos=this.pos.copy(),e.saveOffset=this.saveOffset,e.pan=this.pan,e}}window&&(window.Sound=n)},921:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SoundPosition=void 0;class s{constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.z=s}copy(){var e=new s;return e.x=this.x,e.y=this.y,e.z=this.z,e}updateSoundPosition(e){e.panner.positionX.value=this.x,e.panner.positionY.value=this.y,e.panner.positionZ.value=this.z}}t.SoundPosition=s,window&&(window.SoundPosition=s)}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s(892),s(921)})();